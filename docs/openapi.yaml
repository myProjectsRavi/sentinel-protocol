openapi: 3.1.0
info:
  title: Sentinel Protocol API
  version: 1.0.0
  description: Local AI governance proxy and control-plane endpoints.
servers:
  - url: http://127.0.0.1:8787
paths:
  /_sentinel/health:
    get:
      summary: Health check
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /_sentinel/metrics:
    get:
      summary: Prometheus metrics
      operationId: getMetrics
      responses:
        '200':
          description: Prometheus text exposition.
          content:
            text/plain:
              schema:
                type: string
  /_sentinel/provenance/public-key:
    get:
      summary: Provenance signer public metadata
      operationId: getProvenancePublicKey
      responses:
        '200':
          description: Provenance signer metadata.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Provenance disabled.
  /_sentinel/provenance/verify:
    post:
      summary: Verify output provenance envelope
      operationId: verifyOutputProvenance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                envelope:
                  type: string
                output_sha256:
                  type: string
      responses:
        '200':
          description: Envelope is valid.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '400':
          description: Envelope is invalid.
        '404':
          description: Output provenance disabled.
  /_sentinel/capabilities:
    get:
      summary: Runtime capability snapshot
      operationId: getCapabilities
      responses:
        '200':
          description: Capability snapshot for current runtime.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Capability introspection disabled.
  /_sentinel/attestation:
    get:
      summary: Runtime attestation envelope
      operationId: getAttestation
      responses:
        '200':
          description: Signed runtime attestation.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Attestation disabled.
  /_sentinel/attestation/verify:
    post:
      summary: Verify runtime attestation envelope
      operationId: verifyAttestation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                envelope:
                  type: string
      responses:
        '200':
          description: Attestation is valid.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '400':
          description: Attestation invalid.
        '404':
          description: Attestation disabled.
  /_sentinel/policy/gradient:
    post:
      summary: Evaluate policy threshold changes against historical events
      operationId: analyzePolicyGradient
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                events:
                  type: array
                  items:
                    type: object
                    additionalProperties: true
                current:
                  type: object
                  additionalProperties: true
                proposed:
                  type: object
                  additionalProperties: true
      responses:
        '200':
          description: Policy gradient report.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Policy gradient analyzer disabled.
  /_sentinel/anomalies:
    get:
      summary: Runtime anomaly telemetry snapshot
      operationId: getAnomalyTelemetry
      responses:
        '200':
          description: Anomaly telemetry snapshot.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Anomaly telemetry disabled.
  /_sentinel/threat-intel:
    get:
      summary: Threat intelligence mesh snapshot
      operationId: getThreatIntelMesh
      responses:
        '200':
          description: Threat intelligence signature state.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Threat intel mesh disabled.
  /_sentinel/zk-config:
    get:
      summary: Zero-knowledge config assessment export
      operationId: getZkConfigAssessment
      responses:
        '200':
          description: Redacted configuration assessment and score.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: ZK config validator disabled.
  /_sentinel/adversarial-eval/run:
    post:
      summary: Run adversarial self-evaluation harness
      operationId: runAdversarialEval
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                run_id:
                  type: string
                cases:
                  type: array
                  items:
                    type: object
                    additionalProperties: true
      responses:
        '200':
          description: Adversarial evaluation report.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Adversarial eval harness disabled.
  /_sentinel/swarm/public-key:
    get:
      summary: Swarm protocol public metadata
      operationId: getSwarmPublicKey
      responses:
        '200':
          description: Swarm key metadata.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '404':
          description: Swarm disabled.
  /{proxyPath}:
    parameters:
      - name: proxyPath
        in: path
        required: true
        schema:
          type: string
        description: Upstream provider path (forwards to selected target).
    post:
      summary: Forward proxied request
      operationId: proxyPost
      parameters:
        - name: x-sentinel-target
          in: header
          required: false
          schema:
            type: string
            enum: [openai, anthropic, google, ollama, custom]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
          text/plain:
            schema:
              type: string
      responses:
        '200':
          description: Forwarded response.
        '4XX':
          description: Sentinel block/validation response.
        '5XX':
          description: Upstream or Sentinel runtime error.
    get:
      summary: Forward proxied request
      operationId: proxyGet
      parameters:
        - name: x-sentinel-target
          in: header
          required: false
          schema:
            type: string
            enum: [openai, anthropic, google, ollama, custom]
      responses:
        '200':
          description: Forwarded response.
